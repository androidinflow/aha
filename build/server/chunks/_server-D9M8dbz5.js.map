{"version":3,"file":"_server-D9M8dbz5.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/auth/callback/_server.js"],"sourcesContent":["import { r as redirect } from \"../../../../chunks/index.js\";\nconst GET = async ({ locals, url, cookies }) => {\n  const redirectURL = `${url.origin}/auth/callback`;\n  const expectedState = cookies.get(\"state\");\n  const query = new URLSearchParams(url.search);\n  const state = query.get(\"state\");\n  const code = query.get(\"code\");\n  const authMethods = await locals.pb?.collection(\"users\").listAuthMethods();\n  if (!authMethods?.authProviders) {\n    console.log(\"auth providers not found\");\n    throw redirect(303, \"/login\");\n  }\n  const provider = authMethods.authProviders[0];\n  if (!provider) {\n    console.log(\"Provider not found\");\n    throw redirect(303, \"/login\");\n  }\n  if (expectedState !== state) {\n    console.log(\"state does not match expected\", expectedState, state);\n    throw redirect(303, \"/login\");\n  }\n  try {\n    await locals.pb?.collection(\"users\").authWithOAuth2Code(\n      provider.name,\n      code || \"\",\n      provider.codeVerifier,\n      redirectURL\n    );\n  } catch (err) {\n    console.log(\"Error logging in with OAuth2 user\", err);\n  }\n  throw redirect(303, \"/\");\n};\nexport {\n  GET\n};\n"],"names":[],"mappings":";;AACK,MAAC,GAAG,GAAG,OAAO,EAAE,MAAM,EAAE,GAAG,EAAE,OAAO,EAAE,KAAK;AAChD,EAAE,MAAM,WAAW,GAAG,CAAC,EAAE,GAAG,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC;AACpD,EAAE,MAAM,aAAa,GAAG,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;AAC7C,EAAE,MAAM,KAAK,GAAG,IAAI,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;AAChD,EAAE,MAAM,KAAK,GAAG,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;AACnC,EAAE,MAAM,IAAI,GAAG,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;AACjC,EAAE,MAAM,WAAW,GAAG,MAAM,MAAM,CAAC,EAAE,EAAE,UAAU,CAAC,OAAO,CAAC,CAAC,eAAe,EAAE,CAAC;AAC7E,EAAE,IAAI,CAAC,WAAW,EAAE,aAAa,EAAE;AACnC,IAAI,OAAO,CAAC,GAAG,CAAC,0BAA0B,CAAC,CAAC;AAC5C,IAAI,MAAM,QAAQ,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAC;AAClC,GAAG;AACH,EAAE,MAAM,QAAQ,GAAG,WAAW,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC;AAChD,EAAE,IAAI,CAAC,QAAQ,EAAE;AACjB,IAAI,OAAO,CAAC,GAAG,CAAC,oBAAoB,CAAC,CAAC;AACtC,IAAI,MAAM,QAAQ,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAC;AAClC,GAAG;AACH,EAAE,IAAI,aAAa,KAAK,KAAK,EAAE;AAC/B,IAAI,OAAO,CAAC,GAAG,CAAC,+BAA+B,EAAE,aAAa,EAAE,KAAK,CAAC,CAAC;AACvE,IAAI,MAAM,QAAQ,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAC;AAClC,GAAG;AACH,EAAE,IAAI;AACN,IAAI,MAAM,MAAM,CAAC,EAAE,EAAE,UAAU,CAAC,OAAO,CAAC,CAAC,kBAAkB;AAC3D,MAAM,QAAQ,CAAC,IAAI;AACnB,MAAM,IAAI,IAAI,EAAE;AAChB,MAAM,QAAQ,CAAC,YAAY;AAC3B,MAAM,WAAW;AACjB,KAAK,CAAC;AACN,GAAG,CAAC,OAAO,GAAG,EAAE;AAChB,IAAI,OAAO,CAAC,GAAG,CAAC,mCAAmC,EAAE,GAAG,CAAC,CAAC;AAC1D,GAAG;AACH,EAAE,MAAM,QAAQ,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;AAC3B;;;;"}